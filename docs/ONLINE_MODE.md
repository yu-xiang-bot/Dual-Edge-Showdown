# 联机对战功能说明

## 概述

双锋对决游戏现已支持实时联机对战功能，允许玩家通过互联网与朋友或其他玩家进行对战。

## 功能特性

- **房间系统**：支持创建和加入游戏房间
- **实时同步**：通过Supabase实时数据库实现玩家状态同步
- **角色分配**：房主自动分配法师角色，访客自动分配机械师角色
- **结果记录**：游戏结果自动同步到排行榜
- **状态广播**：实时同步玩家位置、血量、能量等游戏状态

## 使用前准备

### 1. 配置Supabase数据库

确保您已正确配置Supabase数据库连接，并在SQL编辑器中运行以下脚本：

```bash
# 运行数据库初始化脚本
database/database_init.sql
```

### 2. 配置数据库连接

编辑 `scripts/supabase.js` 文件，配置您的Supabase项目URL和API密钥：

```javascript
var SUPABASE_URL = 'https://your-project.supabase.co';
var SUPABASE_ANON_KEY = 'your-anon-key';
```

## 使用指南

### 创建房间

1. 登录游戏账户
2. 在主菜单点击"在线对战"按钮
3. 点击"创建新房间"按钮
4. 系统会生成一个6位房间ID（例如：ABC123）
5. 将房间ID分享给您的朋友
6. 等待玩家加入

### 加入房间

有两种方式加入房间：

**方式1：通过房间ID加入**
1. 登录游戏账户
2. 在主菜单点击"在线对战"按钮
3. 切换到"加入房间"选项卡
4. 输入房间ID（不区分大小写）
5. 点击"加入房间"按钮

**方式2：通过房间列表加入**
1. 在"加入房间"选项卡中
2. 查看可用房间列表
3. 点击想要加入的房间
4. 房间ID会自动填入输入框
5. 点击"加入房间"按钮

### 开始游戏

1. 当有玩家加入房间后，房主会看到"开始游戏"按钮
2. 房主点击"开始游戏"按钮
3. 系统会自动：
   - 房主控制法师（左侧角色）
   - 访客控制机械师（右侧角色）
   - 随机选择一个地图
4. 游戏开始！

## 游戏控制

### 房主（法师）

- **移动**：A(左)、D(右)
- **跳跃**：W(可二段跳)
- **技能**：
  - X - 法力凝聚（增加属性）
  - B - 魔焰射线（攻击）
  - C - 魔障（护盾）
  - V - 炎爆术（蓄力攻击）
  - Q - 替身（大招，能量满时可用）

### 访客（机械师）

- **移动**：←(左)、→(右)
- **跳跃**：↑(可二段跳)
- **技能**：
  - M - 血祭（增加属性）
  - / - 射击（攻击）
  - , - 突进（位移）
  - . - 微型核弹（蓄力攻击）
  - L - 恐怖机器人（大招，能量满时可用）

## 技术实现

### 数据库表结构

**game_rooms** - 游戏房间表
- `id` - 房间ID（6位随机字符串）
- `host_id` - 房主ID
- `host_email` - 房主邮箱
- `guest_id` - 访客ID
- `status` - 房间状态（waiting/ready/playing/cancelled/left）
- `created_at` - 创建时间
- `started_at` - 开始时间
- `ended_at` - 结束时间

### 实时通信

联机功能使用Supabase的实时订阅功能：

1. **房间状态订阅** - 监听房间状态变化
2. **游戏状态广播** - 每100ms同步玩家位置和状态
3. **玩家动作广播** - 实时发送攻击、技能等动作

### 状态同步

- **位置同步**：x、y坐标
- **状态同步**：血量、能量、护盾值
- **动作同步**：移动、攻击、技能使用

## 故障排除

### 无法创建房间

- 检查是否已登录账户
- 确认Supabase配置正确
- 查看浏览器控制台错误信息

### 无法加入房间

- 确认房间ID正确（6位字母数字）
- 检查房间是否已满或已开始
- 确认网络连接正常

### 游戏状态不同步

- 检查网络连接
- 刷新页面重新连接
- 确认两方都使用最新版本

## 注意事项

1. **网络延迟**：联机对战对网络延迟敏感，建议使用稳定的网络连接
2. **房间有效期**：房间在长时间无活动后会自动过期
3. **数据隐私**：游戏数据存储在Supabase中，请确保配置适当的权限策略
4. **版本兼容**：确保所有玩家使用相同版本的客户端

## 未来改进

- [ ] 添加自动匹配系统
- [ ] 支持更多角色选择
- [ ] 添加观战功能
- [ ] 实现回放功能
- [ ] 添加聊天系统
- [ ] 优化网络延迟补偿

## 技术支持

如遇到问题，请：

1. 查看浏览器控制台错误信息
2. 检查Supabase日志
3. 联系开发者或在GitHub提交Issue
