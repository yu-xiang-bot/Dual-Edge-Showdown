<!DOCTYPE html>
<html lang="zh">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
        <title>ÂèåÈîãÂØπÂÜ≥</title>
        <link rel = "stylesheet" href = "styles/cover.css"/>
        <link rel = "stylesheet" href = "styles/new.css"/>
        <link rel = "icon" href = "favicon.ico" type = "image/x-icon" />
    </head>
    <body>
        <!-- ËÉåÊôØÈü≥‰πê -->
        <audio id="bgMusic" loop>
            <source src="assets/sounds/effects/mainMusic.mp3" type="audio/mpeg">
        </audio>
        
        <!-- Èü≥ÈáèÊéßÂà∂ -->
        <div class="volume-control" id="volumeControl">
            <div class="volume-icon" id="volumeIcon">üîä</div>
            <div class="volume-slider-container" id="volumeSliderContainer">
                <input type="range" class="volume-slider" id="volumeSlider" min="0" max="100" value="70">
                <div class="volume-value" id="volumeValue">70%</div>
                <div class="volume-presets">
                    <button class="volume-preset-btn" data-volume="0">0</button>
                    <button class="volume-preset-btn" data-volume="25">25</button>
                    <button class="volume-preset-btn" data-volume="50">50</button>
                    <button class="volume-preset-btn" data-volume="75">75</button>
                    <button class="volume-preset-btn" data-volume="100">100</button>
                </div>
            </div>
        </div>

        <!-- START ÊåâÈíÆ -->
        <div class="start-button-container">
            <a href="pages/login.html" class="start-link">
                <button class="start-button">
                    START
                    <!-- Ë°ÄËøπÊïàÊûú -->
                    <span class="blood-drip" style="left: 10%; animation-delay: 0s;"></span>
                    <span class="blood-drip" style="left: 30%; animation-delay: 1s;"></span>
                    <span class="blood-drip" style="left: 70%; animation-delay: 2s;"></span>
                    <span class="blood-drip" style="left: 90%; animation-delay: 1.5s;"></span>
                    <!-- ÁÅ´ÁÑ∞Ë£ÖÈ•∞ -->
                    <span class="flame" style="top: -15px; left: 20%;">üî•</span>
                    <span class="flame" style="top: -15px; right: 20%; animation-delay: 0.25s;">üî•</span>
                    <!-- Èó™ÁîµÊïàÊûú -->
                    <span class="lightning"></span>
                    <!-- Á¢éÁâáÊïàÊûú -->
                    <span class="shatter" style="top: 20%; left: 10%;"></span>
                    <span class="shatter" style="top: 30%; right: 15%; animation-delay: 0.1s;"></span>
                    <span class="shatter" style="bottom: 25%; left: 25%; animation-delay: 0.2s;"></span>
                    <span class="shatter" style="bottom: 35%; right: 20%; animation-delay: 0.15s;"></span>
                </button>
            </a>
        </div>

        <script>
            document.addEventListener('DOMContentLoaded', function() {
                const bgMusic = document.getElementById('bgMusic');
                const volumeIcon = document.getElementById('volumeIcon');
                const volumeSlider = document.getElementById('volumeSlider');
                const volumeValue = document.getElementById('volumeValue');
                const volumeControl = document.getElementById('volumeControl');
                const volumePresets = document.querySelectorAll('.volume-preset-btn');
                
                // ‰ªélocalStorageËØªÂèñÈü≥ÈáèÁä∂ÊÄÅÔºåÂ¶ÇÊûúÊ≤°ÊúâÂàô‰ΩøÁî®ÈªòËÆ§ÂÄº70%
                let currentVolume = parseInt(localStorage.getItem('bgmVolume')) || 70;
                let savedVolume = parseInt(localStorage.getItem('bgmSavedVolume')) || 70;
                let isMusicPlaying = false;
                
                // ËÆæÁΩÆÂàùÂßãÈü≥ÈáèÂíåUI
                bgMusic.volume = currentVolume / 100;
                volumeSlider.value = currentVolume;
                volumeValue.textContent = currentVolume + "%";
                updateVolumeIcon();
                updateSliderBackground();
                
                // Ê£ÄÊü•Âπ∂‰øùÂ≠òÈü≥È¢ëÁä∂ÊÄÅÂà∞localStorage
                function saveAudioState() {
                    localStorage.setItem('bgmVolume', currentVolume);
                    localStorage.setItem('bgmSavedVolume', savedVolume);
                    localStorage.setItem('bgmIsPlaying', !bgMusic.paused);
                    if (!bgMusic.paused) {
                        localStorage.setItem('bgmCurrentTime', bgMusic.currentTime);
                    }
                }
                
                // ‰ªélocalStorageÊÅ¢Â§çÈü≥È¢ëÁä∂ÊÄÅ
                function restoreAudioState() {
                    const savedIsPlaying = localStorage.getItem('bgmIsPlaying');
                    const savedCurrentTime = localStorage.getItem('bgmCurrentTime');
                    
                    if (savedIsPlaying === 'true' && savedCurrentTime) {
                        bgMusic.currentTime = parseFloat(savedCurrentTime);
                        bgMusic.play().then(() => {
                            isMusicPlaying = true;
                            console.log('ËÉåÊôØÈü≥‰πê‰ªé‰∏äÊ¨°‰ΩçÁΩÆÁªßÁª≠Êí≠Êîæ');
                        }).catch(error => {
                            console.log('ËÉåÊôØÈü≥‰πêÊí≠ÊîæÂ§±Ë¥•:', error);
                        });
                    }
                }
                
                // È°µÈù¢Âç∏ËΩΩÊó∂‰øùÂ≠òÁä∂ÊÄÅ
                window.addEventListener('beforeunload', saveAudioState);
                
                // È°µÈù¢Âä†ËΩΩÊó∂ÊÅ¢Â§çÁä∂ÊÄÅ
                restoreAudioState();
                
                // ÁÇπÂáªÈ°µÈù¢‰ªªÊÑè‰ΩçÁΩÆÂºÄÂßãÊí≠ÊîæÈü≥‰πêÔºàËß£ÂÜ≥ÊµèËßàÂô®Ëá™Âä®Êí≠ÊîæÈôêÂà∂Ôºâ
                document.addEventListener('click', function initMusic() {
                    if (!isMusicPlaying) {
                        bgMusic.play().then(() => {
                            isMusicPlaying = true;
                            console.log('ËÉåÊôØÈü≥‰πêÂºÄÂßãÊí≠Êîæ');
                        }).catch(error => {
                            console.log('ËÉåÊôØÈü≥‰πêÊí≠ÊîæÂ§±Ë¥•:', error);
                        });
                        
                        // ÁßªÈô§‰∫ã‰ª∂ÁõëÂê¨Âô®
                        document.removeEventListener('click', initMusic);
                    }
                }, { once: true });
                
                // Èü≥ÈáèÂõæÊ†áÁÇπÂáª‰∫ã‰ª∂
                volumeIcon.addEventListener('click', function() {
                    if (currentVolume > 0) {
                        // ‰øùÂ≠òÂΩìÂâçÈü≥ÈáèÂπ∂ÈùôÈü≥
                        savedVolume = currentVolume;
                        currentVolume = 0;
                        volumeSlider.value = 0;
                        volumeValue.textContent = "0%";
                        updateVolumeIcon("üîá");
                        volumeControl.classList.add("muted");
                    } else {
                        // ÊÅ¢Â§ç‰πãÂâçÁöÑÈü≥Èáè
                        currentVolume = savedVolume || 70;
                        volumeSlider.value = currentVolume;
                        volumeValue.textContent = currentVolume + "%";
                        updateVolumeIcon();
                        volumeControl.classList.remove("muted");
                    }
                    bgMusic.volume = currentVolume / 100;
                    saveAudioState();
                });
                
                // Èü≥ÈáèÊªëÂùóÂèòÂåñ‰∫ã‰ª∂
                volumeSlider.addEventListener('input', function() {
                    currentVolume = parseInt(this.value);
                    volumeValue.textContent = currentVolume + "%";
                    bgMusic.volume = currentVolume / 100;
                    updateVolumeIcon();
                    
                    // Â¶ÇÊûúÁî®Êà∑‰ªéÈùôÈü≥Áä∂ÊÄÅË∞ÉÊï¥Èü≥ÈáèÔºåËá™Âä®ÂèñÊ∂àÈùôÈü≥
                    if (currentVolume > 0 && volumeControl.classList.contains("muted")) {
                        volumeControl.classList.remove("muted");
                    }
                    
                    // ‰øùÂ≠òÁä∂ÊÄÅÂπ∂Êõ¥Êñ∞ÊªëÂùóËÉåÊôØ
                    saveAudioState();
                    updateSliderBackground();
                });
                
                // Èü≥ÈáèÈ¢ÑËÆæÊåâÈíÆÁÇπÂáª‰∫ã‰ª∂
                volumePresets.forEach(function(btn) {
                    btn.addEventListener('click', function() {
                        const presetVolume = parseInt(this.dataset.volume);
                        currentVolume = presetVolume;
                        volumeSlider.value = currentVolume;
                        volumeValue.textContent = currentVolume + "%";
                        updateVolumeIcon();
                        bgMusic.volume = currentVolume / 100;
                        
                        // Â¶ÇÊûúËÆæÁΩÆ‰∫ÜÈü≥ÈáèÔºåÂèñÊ∂àÈùôÈü≥Áä∂ÊÄÅ
                        if (currentVolume > 0 && volumeControl.classList.contains("muted")) {
                            volumeControl.classList.remove("muted");
                        }
                        
                        // ‰øùÂ≠òÁä∂ÊÄÅ
                        savedVolume = currentVolume;
                        saveAudioState();
                        
                        // Ê∑ªÂä†ÁÇπÂáªÂèçÈ¶àÂä®Áîª
                        this.classList.add("active");
                        setTimeout(() => {
                            this.classList.remove("active");
                        }, 200);
                    });
                });
                
                // Êõ¥Êñ∞Èü≥ÈáèÂõæÊ†á
                function updateVolumeIcon(customIcon) {
                    if (customIcon) {
                        volumeIcon.textContent = customIcon;
                        return;
                    }
                    
                    if (currentVolume == 0) {
                        volumeIcon.textContent = "üîá";
                    } else if (currentVolume < 30) {
                        volumeIcon.textContent = "üîà";
                    } else if (currentVolume < 70) {
                        volumeIcon.textContent = "üîâ";
                    } else {
                        volumeIcon.textContent = "üîä";
                    }
                    
                    // Êõ¥Êñ∞ÊªëÂùóÁöÑËÉåÊôØÊ∏êÂèòÔºåÂèçÊò†ÂΩìÂâçÈü≥Èáè‰ΩçÁΩÆ
                    updateSliderBackground();
                }
                
                // Êõ¥Êñ∞ÊªëÂùóËÉåÊôØÊ∏êÂèò
                function updateSliderBackground() {
                    const percentage = currentVolume;
                    const color1 = percentage < 30 ? '#ff5252' : percentage < 70 ? '#ffeb3b' : '#4caf50';
                    const color2 = percentage < 30 ? '#ffeb3b' : percentage < 70 ? '#4caf50' : '#2e7d32';
                    volumeSlider.style.background = `linear-gradient(to right, ${color1} 0%, ${color1} ${percentage}%, rgba(255,255,255,0.2) ${percentage}%, rgba(255,255,255,0.2) 100%)`;
                }
                
                // ÂàùÂßãÂåñÊªëÂùóËÉåÊôØ
                updateSliderBackground();
            });
        </script>

    </body>
</html>